-- // services
get_service = function(service)
	return cloneref(game:GetService(service));
end;

local players = get_service("Players");
local replicated_storage = get_service("ReplicatedStorage");
local http_service = get_service("HttpService");
local run_service = get_service("RunService");
local user_input_service = get_service("UserInputService");

-- // references
local local_player = players.LocalPlayer;
local remote = replicated_storage.Packages.Net["RE/LaserGun_Fire"];
local settings = require(replicated_storage.Shared.LaserGunsShared).Settings;

-- // gun mods (extreme settings)
settings.Radius.Value = 256;
settings.MaxBounces.Value = 9999;
settings.MaxAge.Value = 1e6;
settings.StunDuration.Value = 60;
settings.ImpulseForce.Value = 1e6;
settings.Cooldown.Value = 0;

-- // states
local spam_active = false;
local spam_threads = {};

-- // ui
local screen_gui = Instance.new("ScreenGui");
screen_gui.Name = "LaserGunSpammer";
screen_gui.Parent = local_player:WaitForChild("PlayerGui");
screen_gui.ResetOnSpawn = false;

local frame = Instance.new("Frame");
frame.Size = UDim2.new(0, 200, 0, 100);
frame.Position = UDim2.new(0.5, -100, 0, 60);
frame.BackgroundColor3 = Color3.fromRGB(35, 35, 45);
frame.BorderSizePixel = 0;
frame.Active = true;
frame.Parent = screen_gui;

local corner = Instance.new("UICorner");
corner.CornerRadius = UDim.new(0, 12);
corner.Parent = frame;

-- Title
local title = Instance.new("TextLabel");
title.Size = UDim2.new(1, -20, 0, 30);
title.Position = UDim2.new(0, 10, 0, 5);
title.Text = "Laser Gun Spammer";
title.TextColor3 = Color3.fromRGB(255, 255, 255);
title.Font = Enum.Font.GothamBold;
title.TextSize = 16;
title.BackgroundTransparency = 1;
title.Parent = frame;

-- Start Button
local start_button = Instance.new("TextButton");
start_button.Size = UDim2.new(0, 85, 0, 35);
start_button.Position = UDim2.new(0, 10, 0, 50);
start_button.Text = "START";
start_button.TextColor3 = Color3.fromRGB(255, 255, 255);
start_button.Font = Enum.Font.GothamBold;
start_button.TextSize = 14;
start_button.BackgroundColor3 = Color3.fromRGB(46, 204, 113);
start_button.BorderSizePixel = 0;
start_button.AutoButtonColor = false;
start_button.Parent = frame;

local start_corner = Instance.new("UICorner");
start_corner.CornerRadius = UDim.new(0, 8);
start_corner.Parent = start_button;

-- Stop Button
local stop_button = Instance.new("TextButton");
stop_button.Size = UDim2.new(0, 85, 0, 35);
stop_button.Position = UDim2.new(0, 105, 0, 50);
stop_button.Text = "STOP";
stop_button.TextColor3 = Color3.fromRGB(255, 255, 255);
stop_button.Font = Enum.Font.GothamBold;
stop_button.TextSize = 14;
stop_button.BackgroundColor3 = Color3.fromRGB(231, 76, 60);
stop_button.BorderSizePixel = 0;
stop_button.AutoButtonColor = false;
stop_button.Parent = frame;

local stop_corner = Instance.new("UICorner");
stop_corner.CornerRadius = UDim.new(0, 8);
stop_corner.Parent = stop_button;

-- // draggable functionality
local dragging = false;
local drag_input, drag_start, start_pos;

frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true;
		drag_start = input.Position;
		start_pos = frame.Position;

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false;
			end;
		end);
	end;
end);

frame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		drag_input = input;
	end;
end);

user_input_service.InputChanged:Connect(function(input)
	if dragging and input == drag_input then
		local delta = input.Position - drag_start;
		frame.Position = UDim2.new(
			start_pos.X.Scale, start_pos.X.Offset + delta.X,
			start_pos.Y.Scale, start_pos.Y.Offset + delta.Y
		);
	end;
end);

-- // get nearest player
get_nearest = function()
	local nearest_player;
	local shortest_distance = math.huge;

	local local_character = local_player.Character;
	if not local_character or not local_character.PrimaryPart then
		return nil;
	end;

	local local_position = local_character.PrimaryPart.Position;

	for _, player in players:GetPlayers() do
		local character = player.Character;
		if player ~= local_player and character and character.PrimaryPart then
			local distance = (local_position - character.PrimaryPart.Position).Magnitude;
			if distance < shortest_distance then
				shortest_distance = distance;
				nearest_player = player;
			end;
		end;
	end;

	return nearest_player;
end;

-- // equip laser gun
equip_laser_gun = function()
	local character = local_player.Character;
	if not character then
		return false;
	end;

	local equipped_tool = character:FindFirstChildOfClass("Tool");
	if equipped_tool and equipped_tool.Name == "Laser Gun" then
		return true;
	end;

	local backpack = local_player:FindFirstChild("Backpack");
	if backpack then
		local laser_gun = backpack:FindFirstChild("Laser Gun");
		if laser_gun then
			local humanoid = character:FindFirstChild("Humanoid");
			if humanoid then
				humanoid:EquipTool(laser_gun);
				return true;
			end;
		end;
	end;

	return false;
end;

-- // extreme spam function (sends multiple requests per frame)
spam_laser_extreme = function()
	while spam_active do
		local character = local_player.Character;
		if character and character.PrimaryPart then
			local tool = character:FindFirstChildOfClass("Tool");
			if tool and tool.Name == "Laser Gun" then
				local target_player = get_nearest();
				if target_player and target_player.Character and target_player.Character.PrimaryPart then
					local pos1 = character.PrimaryPart.Position;
					local pos2 = target_player.Character.PrimaryPart.Position;
					local direction = (pos2 - pos1).Unit;
					
					-- Fire multiple times instantly (20 shots per iteration)
					for i = 1, 20 do
						local id = http_service:GenerateGUID(false):lower():gsub("%-", "");
						remote:FireServer(id, pos1, direction, workspace:GetServerTimeNow());
					end;
				end;
			end;
		end;
		task.wait(); -- Minimal wait, fires 20 shots every heartbeat
	end;
end;

-- // start button
start_button.MouseButton1Click:Connect(function()
	if spam_active then
		return;
	end;

	if not equip_laser_gun() then
		title.Text = "No Laser Gun Found!";
		task.wait(2);
		title.Text = "Laser Gun Spammer";
		return;
	end;

	spam_active = true;
	start_button.BackgroundColor3 = Color3.fromRGB(39, 174, 96);
	title.Text = "EXTREME LAG MODE!";

	-- Create multiple spam threads for maximum lag
	for i = 1, 5 do
		table.insert(spam_threads, task.spawn(spam_laser_extreme));
	end;
end);

-- // stop button
stop_button.MouseButton1Click:Connect(function()
	if not spam_active then
		return;
	end;

	spam_active = false;
	start_button.BackgroundColor3 = Color3.fromRGB(46, 204, 113);
	title.Text = "Laser Gun Spammer";

	-- Clear all spam threads
	for _, thread in spam_threads do
		task.cancel(thread);
	end;
	spam_threads = {};
end);

-- // cleanup on death
local_player.CharacterAdded:Connect(function()
	if spam_active then
		spam_active = false;
		start_button.BackgroundColor3 = Color3.fromRGB(46, 204, 113);
		title.Text = "Laser Gun Spammer";
		for _, thread in spam_threads do
			task.cancel(thread);
		end;
		spam_threads = {};
	end;
end);
